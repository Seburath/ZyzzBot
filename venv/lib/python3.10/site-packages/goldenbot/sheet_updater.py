#!/usr/bin/env python3

from oauth2client.service_account import ServiceAccountCredentials
from gspread import authorize
from pandas import DataFrame


def get_trabajadores_data(db):
    data_dict = {
        "Id": [],
        "Trabajador": [],
    }

    for id, trabajador in db.get_trabajadores():
        data_dict["Id"].append(id)
        data_dict["Trabajador"].append(trabajador)

    data = DataFrame.from_dict(data_dict)
    return data


def get_bodega_data(db):
    data_dict = {
        "Id": [],
        "Producto": [],
        "Trabajadores": [],
        "Fecha": [],
        "Var": [],
        "Total": [],
    }

    for id, producto, trabajadores, var, date, total in db.get_all_bodega():
        data_dict["Id"].append(id)
        data_dict["Producto"].append(producto)
        data_dict["Trabajadores"].append(trabajadores)

        data_dict["Fecha"].append(date)
        data_dict["Variacion"].append(str(var))
        data_dict["Total"].append(str(total))

    data = DataFrame.from_dict(data_dict)
    return data


def get_pagos_data(db):
    data_dict = {
        "Id": [],
        "User": [],
        "Tipo": [],
        "Fecha_Var": [],
        "Var": [],
        "Total": [],
    }

    for id, trabajador, tipo, fd, date, var, total in db.get_all_pagos():
        data_dict["Id"].append(id)
        data_dict["User"].append(trabajador)
        data_dict["Tipo"].append(tipo)

        data_dict["fd"].append(fd)

        data_dict["Fecha"].append(date)
        data_dict["Variacion"].append(str(var))
        data_dict["Total"].append(str(total))

    data = DataFrame.from_dict(data_dict)
    return data


def update(data, sheet):
    scope = [
        "https://spreadsheets.google.com/feeds",
        "https://www.googleapis.com/auth/drive",
    ]

    credentials = ServiceAccountCredentials.from_json_keyfile_dict(
        {
            "type": "service_account",
            "project_id": "goldenbot-344412",
            "private_key_id": "48075e79d11e3ae470b2fe3e4d7f070e5f371531",
            "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCYQjhE/LuiPUjU\nYCaw8rpLpxefUdjhatCB6Q/C9D6pFIBn+iEZr3IWTqgv25zvCLuSArZuQiCNrySa\nPd0ynprlhCDQaKNkfVnWu72yjLaH7N5ETSvmbQy5hhe1xzDah2Um0ZE8JHViE2Wf\nD6EAC9ki9C9DMaGlMoCl7hZQXr6BtxAkXE1HEfJqkS2gmR6n9GTlHlyyqVP4IBpx\nETmyLahf2A3I/ob1KZk858D/Y2nmNCRJSBjRMtBiTPjVVupCfDVndhbeJeY/KUvM\nauE4Hb4KkW0ZXHVChz/rGzeORtlNp89f9n8KZqFEdvezw1Qm/sL3DBDgCVUy1enG\nH7KreMmfAgMBAAECggEASB5FjNexAF3K211XtkSiXSceF0arVcpETORZpNwPugKN\n97IQb5wci9hh7Zk2MjqOrdA/HOaRiMrGqZBX75wUflYhPNXzXqvJG979MU9ZPfTC\nKtPq0VAh0NZk8KMSzs+G5+Ynxrb2KqhJYBgFCIKULOxAXrFpgVf0e6PUSek2jzWt\nj5DFWCtIY6pm5l6r325/a4hXWcq67LUd2WXKj4sr3STolNLIjqv7dyWYOw5U9J9e\nw7gBfit2ZfKx9NnoLFRuVvlyjt9O76db83d5AUNpbJnLSBQN1fUu4bRJJ+YazClZ\nBXmlS6GaSeoY7xWxKSBDlbS8ep+skkKiHiF9D23csQKBgQDItEjrVBf3f9HVazUl\nlCtItvudn05u/sMvD5nFcjfNHhryTWSJV3ISwVv22qGMU6vM8cdgpFKzccvo7ZfD\nsNz3vUrU6mhyRd0XFNKToAdZqNW0Dh5fBaq/4uGgaPT5dqKx/NT9d8LxgneVZ+is\nx8oTXlakBom3sVBHAp+xkyadvQKBgQDCNQ7nwWQYtqMWB3V4ilb/wty03Wc50p5l\nKqTthILAUeE26ghbDs9wr1xbz7G3z2zI/dHb3cve2GGXwHWpk7Y2EOTds0RXO9TH\nF7m3Mp1BkDPlwnYAYiU227+DSSaBqIGd2btvrtpUw/167aLvjvXF1JQW+MT6brWM\nD9pdJ930iwKBgQCsczPgeB4ru/kZDofY5SoXzZn/Al3LQz2EVzxCCfTmWsK+hT8o\nPym18cxKG+sI/u+0Jd6xLCAfLV0Oo+9t5q7GczA0J8FcxqjEZ1DUJYGLSWVt01/H\nN8BSJejGAsjS/Fuo4VxE+b1X9Ek559FlfDkmUT3SrAdy/XjDuv5p/s0EZQKBgDKS\ncoEzQQeWd72Cz7pF/AW6DpMinIDYMdsSUcRwH0RJjiYop2he4PHtGFXoLdU5tJBa\nWE2y4iXznuZPfdRc3LQTjiWVSxSURgJaUUg9a+nozTrleqj65cn1S1e6ssZMxQP/\n8OlSVRSBvP5H54gOaD3N74pT2aeFMM16S1i6yvelAoGAKRUEH5mGmDRxmMKi5CKz\nLtJur2g+5NFx/S9tP1WLsSc1vDS9ADSElNuFa9L288mmCa6QTudIpeLfvDzHrVT+\nDlpMULsUNYnB6peK+SAIzkdXsptxbSLfHvw6ZdHMQNjFcRADeBtuPD3dCGxWe7R/\nZ/JE2IVecx90UjwrN2Iehqk=\n-----END PRIVATE KEY-----\n",
            "client_email": "goldenbot@goldenbot-344412.iam.gserviceaccount.com",
            "client_id": "104192093284956008649",
            "auth_uri": "https://accounts.google.com/o/oauth2/auth",
            "token_uri": "https://oauth2.googleapis.com/token",
            "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
            "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/goldenbot%40goldenbot-344412.iam.gserviceaccount.com",
        },
        scope,
    )

    client = authorize(credentials)
    spreadsheet = client.open("GoldenBot")
    sheet = spreadsheet.get_worksheet(sheet)

    sheet.update([data.columns.values.tolist()] + data.values.tolist())


def update_goldenbot_sheet(db):
    update(get_pagos_data(db), 0)
    update(get_bodega_data(db), 1)
    update(get_trabajadores_data(db), 2)
